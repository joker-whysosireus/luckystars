<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lucky Stars</title>
    
    <link rel="stylesheet" href="index.css">
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- Adexium Widget -->
    <script type="text/javascript" src="https://cdn.tgads.space/assets/js/adexium-widget.min.js"></script>
    
    <!-- GigaPub SDK (обновленная версия) -->
    <script data-project-id="3186">
      !function(){
        var s=document.currentScript,p=s.getAttribute('data-project-id')||'default';
        var d=['https://ad.gigapub.tech','https://ru-ad.gigapub.tech'],i=0,t,sc;
        function l(){
          sc=document.createElement('script');
          sc.async=true;
          sc.src=d[i]+'/script?id='+p;
          clearTimeout(t);
          t=setTimeout(function(){
            sc.onload=sc.onerror=null;
            sc.src='';
            if(++i<d.length)l();
          },15000);
          sc.onload=function(){
            clearTimeout(t);
            console.log("GigaPub SDK загружен успешно");
            // Инициализируем функцию показа рекламы после загрузки
            if (window.gigaOfferWallSDK) {
              window.gigaOfferWallSDK.init({
                projectId: "3186"
              });
              
              window.showGiga = function() {
                return new Promise((resolve, reject) => {
                  if (window.gigaOfferWallSDK && typeof window.gigaOfferWallSDK.open === 'function') {
                    window.gigaOfferWallSDK.open();
                    console.log("GigaPub OfferWall открыт");
                    resolve();
                  } else {
                    const error = "GigaPub SDK недоступен";
                    console.error(error);
                    reject(new Error(error));
                  }
                });
              };
              console.log("GigaPub функция showGiga инициализирована");
            }
          };
          sc.onerror=function(){
            clearTimeout(t);
            console.error("Ошибка загрузки GigaPub с", d[i]);
            if(++i<d.length)l();
          };
          document.head.appendChild(sc);
        }
        l();
      }();
    </script>

    <!-- Резервная функция GigaPub -->
    <script type="text/javascript">
      // Резервная функция на случай недоступности GigaPub
      window.AdGigaFallback = function() {
        return new Promise((resolve) => {
          console.log("Используем резервную рекламу GigaPub");
          // Симулируем успешный показ рекламы через 1 секунду
          setTimeout(resolve, 1000);
        });
      };

      // Создаем функцию showGiga, если она не была создана скриптом GigaPub
      setTimeout(() => {
        if (typeof window.showGiga !== 'function') {
          console.warn("GigaPub не загрузился, используем резервную функцию");
          window.showGiga = window.AdGigaFallback;
        }
      }, 5000);
    </script>

    <!-- Инициализация Adexium с улучшенным показом -->
    <script type="text/javascript">
      // Инициализация и запуск после полной загрузки DOM
      document.addEventListener('DOMContentLoaded', () => {
        let adexiumAds = null;
        let adexiumInterval = null;
        let lastAdTime = 0;
        const AD_COOLDOWN = 30000; // 30 секунд

        // Функция показа рекламы Adexium
        const showAdexiumAd = () => {
          const now = Date.now();
          if (now - lastAdTime < AD_COOLDOWN) {
            console.log("Реклама Adexium еще в кулдауне");
            return;
          }

          try {
            if (adexiumAds && typeof adexiumAds.showAd === 'function') {
              console.log("Показываем рекламу Adexium");
              adexiumAds.showAd();
              lastAdTime = now;
            } else if (adexiumAds && adexiumAds.autoMode) {
              console.log("Adexium в автоматическом режиме");
              lastAdTime = now;
            } else {
              console.log("Adexium недоступен для показа");
            }
          } catch (error) {
            console.error("Ошибка при показе рекламы Adexium:", error);
          }
        };

        // Проверяем, что класс AdexiumWidget доступен
        if (typeof AdexiumWidget !== 'undefined') {
          adexiumAds = new AdexiumWidget({
            wid: 'e279c53e-42c1-42b9-93be-a535d900a92e', // Замените на ваш Widget ID
            adFormat: 'interstitial'
          });

          // Запускаем автоматический режим
          adexiumAds.autoMode();

          // Автоматический показ рекламы каждые 30 секунд
          adexiumInterval = setInterval(showAdexiumAd, AD_COOLDOWN);

          // Показываем первую рекламу через 10 секунд после загрузки
          setTimeout(showAdexiumAd, 10000);

          // Делаем функцию доступной глобально для ручного вызова
          window.showAd = showAdexiumAd;

          console.log('Adexium Widget инициализирован с интервалом 30 секунд');

        } else {
          console.error('Ошибка: Скрипт Adexium не загружен корректно.');
          
          // Резервная функция если Adexium недоступен
          window.showAd = function() {
            console.log("Adexium недоступен, используем резервный метод");
            return Promise.resolve();
          };
        }

        // Дополнительный показ рекламы при взаимодействии с пользователем
        document.addEventListener('click', () => {
          setTimeout(showAdexiumAd, 1000);
        });

        // Очистка интервала при разгрузке страницы
        window.addEventListener('beforeunload', () => {
          if (adexiumInterval) {
            clearInterval(adexiumInterval);
          }
        });
      });
    </script>
</head>
<body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
</body>
</html>